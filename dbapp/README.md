# Database application project 

This project contains the deployment scripts and utility functions for creating and querying the database tables for the theorem search project.

It supports three main tables:

1) Metadata such as authors, date of publication, arXiv ID, etc. 
2) Statements of theorems and the contextual text.
3) Data for literal search, which is one search algorithm used when a nontrivial portion of the query is not contained in the precompiled vocabulary.

## Deployment:

When the theorem data are recompiled, affecting theorem indexing for all theorems, entire tables need to be re-populated with the updated data.

On the server hosting the databases, deployment can be run such as follows:

```bash java -cp dbApp.jar:log4j-core-2.6.2.jar:log4j-api-2.6.2.jar:mysql-jdbc-5.1.44.jar:thmProj.jar -dirpath pathToDBbasedir com.wolfram.puremath.dbapp.DBDeploy```

where the `-cp` option specifies the classpath, and the `-dirpath` option specifies the path to the base directory, with respect to which the data are located. 

The database settings used by the scripts are located in the `dbConfig.properties` file, to be located in the top-level directory.

Specifically, `dbConfig.properties` include the database access data in the following format:

```
username=...
password=...
query_username=...
query_password=...
defaultDirPath=...
```

## Data
The raw data used by the deployment scripts should be located under the `defaultDirPath/src/thmp/data` directory, where `defaultDirPath` is the directory specified in the above configuration file.

The data directory should contain the data as generated by the scripts in the theorem search respository, including _metaDataNameDB.csv_, and a directory named _pe_ containing the set of files _combinedParsedExpressionListi_, where the concluding _i_ denotes the index of the file.

Examples of _metaDataNameDB.csv_ and _combinedParsedExpressionList_ are located under the `src/thmp/data` directory.

## Build

To build the project, run the ant script with the default target: `ant run`.

## Example

For instance, the resulting theorem statements table will look like:
```
mysql> DESCRIBE thmHypTb;
+----------+----------------+------+-----+---------+-------+
| Field    | Type           | Null | Key | Default | Extra |
+----------+----------------+------+-----+---------+-------+
| thmIndex | int(11)        | NO   | PRI | NULL    |       |
| thm      | varchar(32700) | YES  |     | NULL    |       |
| hyp      | varchar(32700) | YES  |     | NULL    |       |
| fileName | varchar(50)    | YES  |     | NULL    |       |
| thmType  | varchar(15)    | YES  |     | NULL    |       |
+----------+----------------+------+-----+---------+-------+
5 rows in set (0.00 sec)

mysql> SELECT COUNT(*) FROM thmHypTb;
+----------+
| COUNT(*) |
+----------+
|  2425867 |
+----------+
1 row in set (1.60 sec)
```
